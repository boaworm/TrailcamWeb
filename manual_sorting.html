<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Data on manually sorted images (not ML)</title>

	<script src="d3.v7.js"></script>
	<script src="shared.js"></script>
	<script src="oklahoma_observations.json.js"></script>
	<script src="deer_observations.json.js"></script>
	<script src="manually_sorted_categories.json.js"></script>
	<script src="manually_classified.json.js"></script>
	<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
	<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>


	<script>
		APP = Vue.createApp({
			props: {},
			data: function() {
				return {
					// selectedCamera : "TOP",
				};
			},
			methods: {
				/*
				cameraUpdate : function(){
					renderGraphs(this.selectedCamera);
				}
				*/
			},
			computed: { },
			mounted: function() {
				renderGraphs();
				// renderGraphs(this.selectedCamera);
			}
		});
	</script>

</head>

<body>
<div id="cameraApp">

<table>
	<tr>
		<td><a href="index.html">Back</a></td>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td><div id="obsPerAnimal"></div></td>
		<td><div class="divTableCell" id="obsPerMonth"></div></td>
		<td><div class="divTableCell" id="obsPerHour"></div></td>
	</tr>

	<tr>
		<td><div class="divTableCell" id="obsPieTop"></div></td>
		<td><div class="divTableCell" id="obsPieMiddle"></div></td>
		<td><div class="divTableCell" id="obsPieHouse"></div></td>
	</tr>
</table>
</div>

<!-- Script code -->


<script>
///////// BEGIN MAIN DATA PROCESSING ////////////
// Extract what years the code is active:

function getManualCategoryForImage(image){

	const matchObj = MANUALLY_CLASSIFIED.filter(function(d){
		return d.image === image;	
	});

	if(matchObj[0]){
		return matchObj[0].classification;
	}else{
		return "NONE";
	}
}

function renderGraphs(){

	// GLOBALS
	const obsPerAnimalObject = [];
	const obsPerCategoryCameraObject = [[]];

	MANUALLY_SORTED_CATEGORIES.forEach((category) => {
		var obs = {};
		obs["category"] = category.category;
		obs["count"] = category.count;
		obsPerAnimalObject.push(obs);
	});

	cameraArray.forEach( (camera) => {
		obsPerCategoryCameraObject[camera] = [];	

		const perCameraObs = DATA.filter(function(d){
			return d.camera === camera &&
					+d.count > 0;
		});

		MANUALLY_SORTED_CATEGORIES.forEach( (categoryObj) => {
			const category = categoryObj.category;

			const totalObservations = perCameraObs.reduce(function(a,d){
				if( getManualCategoryForImage(d.image) === category ){
					return a + +d.count;
				}else{
					return a;
				}
			},0);

			const obj = {
				"category" : category,
				"count" : totalObservations
			};
			obsPerCategoryCameraObject[camera].push(obj);
		});

	});


	// #### Start rendering data into graphs ####
	createHBarGraph("#obsPerAnimal", "Total images per category", obsPerAnimalObject, "category", "count");

	// pie charts, one for each camera
	createPieChart("#obsPieTop", "Animal distribution - Top camera", obsPerCategoryCameraObject["TOP"]);
	createPieChart("#obsPieMiddle", "Animal distribution - Middle camera", obsPerCategoryCameraObject["MIDDLE"]);
	createPieChart("#obsPieHouse", "Animal distribution - House camera", obsPerCategoryCameraObject["HOUSE"]);

}
</script>

<script>
	APP.mount('#cameraApp');
</script>

</body>

</html>
